merge into pcdm.DW_DIM_AGENT as TARGET   	
using pcdm.STG_dim_agent as source
on (  Target.AGENT_KEY = source.AGENT_KEY  )
when matched and 
hash(TARGET.AGENT_ID,
TARGET.AGENT_KEY,
TARGET.SOURCE,
TARGET.AGENT_NAME,
TARGET.AGENT_CODE,
TARGET.AGENT_ADDRESS_1,
TARGET.AGENT_ADDRESS_2,
TARGET.AGENT_ADDRESS_3,
TARGET.AGENT_CITY,
TARGET.AGENT_STATE_CODE,
TARGET.AGENT_STATE_CODE_DESCRIPTION,
TARGET.AGENT_ZIP_CODE,
TARGET.AGENT_PHONE_NUMBER,
TARGET.AGENT_APPT_DATE,
TARGET.AGENT_TERM_DATE,
TARGET.AGENT_STATUS_CODE,
TARGET.MANAGER_NAME,
TARGET.REP_CODE,
TARGET.REGION_CODE,
TARGET.AGENT_LIC_NUMBER,
TARGET.AGENT_TAX_ID,		
TARGET.PRODUCERGROUP_NAME,
TARGET.BRANCHNAME	
 ) <> hash(SOURCE.AGENT_ID,
SOURCE.AGENT_KEY,
SOURCE.SOURCE,
SOURCE.AGENT_NAME,
SOURCE.AGENT_CODE,
SOURCE.AGENT_ADDRESS_1,
SOURCE.AGENT_ADDRESS_2,
SOURCE.AGENT_ADDRESS_3,
SOURCE.AGENT_CITY,
SOURCE.AGENT_STATE_CODE,
SOURCE.AGENT_STATE_CODE_DESCRIPTION,
SOURCE.AGENT_ZIP_CODE,
SOURCE.AGENT_PHONE_NUMBER,
SOURCE.AGENT_APPT_DATE,
SOURCE.AGENT_TERM_DATE,
SOURCE.AGENT_STATUS_CODE,
SOURCE.MANAGER_NAME,
SOURCE.REP_CODE,
SOURCE.REGION_CODE,
SOURCE.AGENT_LIC_NUMBER,
SOURCE.AGENT_TAX_ID,
SOURCE.PRODUCERGROUP_NAME,
SOURCE.BRANCHNAME
)then update set
TARGET.AGENT_ID = SOURCE.AGENT_ID,
TARGET.AGENT_KEY = SOURCE.AGENT_KEY,
TARGET.SOURCE = SOURCE.SOURCE,
TARGET.AGENT_NAME = SOURCE.AGENT_NAME,
TARGET.AGENT_CODE = SOURCE.AGENT_CODE,
TARGET.AGENT_ADDRESS_1 = SOURCE.AGENT_ADDRESS_1,
TARGET.AGENT_ADDRESS_2 = SOURCE.AGENT_ADDRESS_2,
TARGET.AGENT_ADDRESS_3 = SOURCE.AGENT_ADDRESS_3,
TARGET.AGENT_CITY = SOURCE.AGENT_CITY,
TARGET.AGENT_STATE_CODE = SOURCE.AGENT_STATE_CODE,
TARGET.AGENT_STATE_CODE_DESCRIPTION = SOURCE.AGENT_STATE_CODE_DESCRIPTION,
TARGET.AGENT_ZIP_CODE = SOURCE.AGENT_ZIP_CODE,
TARGET.AGENT_PHONE_NUMBER = SOURCE.AGENT_PHONE_NUMBER,
TARGET.AGENT_APPT_DATE = SOURCE.AGENT_APPT_DATE,
TARGET.AGENT_TERM_DATE = SOURCE.AGENT_TERM_DATE,
TARGET.AGENT_STATUS_CODE = SOURCE.AGENT_STATUS_CODE,
TARGET.MANAGER_NAME = SOURCE.MANAGER_NAME,
TARGET.REP_CODE = SOURCE.REP_CODE,
TARGET.REGION_CODE = SOURCE.REGION_CODE,
TARGET.AGENT_LIC_NUMBER = SOURCE.AGENT_LIC_NUMBER,
TARGET.AGENT_TAX_ID = SOURCE.AGENT_TAX_ID,			
TARGET.PRODUCERGROUP_NAME = SOURCE.PRODUCERGROUP_NAME,
TARGET.BRANCHNAME = SOURCE.BRANCHNAME,	
TARGET.ETL_ACTIVE_FLAG ='Y',
TARGET.ETL_ADD_DATETIMESTAMP=current_timestamp	
when not matched 
then insert 
(AGENT_ID,
AGENT_KEY,
SOURCE,
AGENT_NAME,
AGENT_CODE,
AGENT_ADDRESS_1,
AGENT_ADDRESS_2,
AGENT_ADDRESS_3,
AGENT_CITY,
AGENT_STATE_CODE,
AGENT_STATE_CODE_DESCRIPTION,
AGENT_ZIP_CODE,
AGENT_PHONE_NUMBER,
AGENT_APPT_DATE,
AGENT_TERM_DATE,
AGENT_STATUS_CODE,
MANAGER_NAME,
REP_CODE,
REGION_CODE,
AGENT_LIC_NUMBER,
AGENT_TAX_ID,
ETL_ACTIVE_FLAG,
ETL_ADD_DATETIMESTAMP,
ETL_LAST_UPDATE_DATETIMESTAMP,
PRODUCERGROUP_NAME,
BRANCHNAME	
) values (SOURCE.AGENT_ID,
SOURCE.AGENT_KEY,
SOURCE.SOURCE,
SOURCE.AGENT_NAME,
SOURCE.AGENT_CODE,
SOURCE.AGENT_ADDRESS_1,
SOURCE.AGENT_ADDRESS_2,
SOURCE.AGENT_ADDRESS_3,
SOURCE.AGENT_CITY,
SOURCE.AGENT_STATE_CODE,
SOURCE.AGENT_STATE_CODE_DESCRIPTION,
SOURCE.AGENT_ZIP_CODE,
SOURCE.AGENT_PHONE_NUMBER,
SOURCE.AGENT_APPT_DATE,
SOURCE.AGENT_TERM_DATE,
SOURCE.AGENT_STATUS_CODE,
SOURCE.MANAGER_NAME,
SOURCE.REP_CODE,
SOURCE.REGION_CODE,
SOURCE.AGENT_LIC_NUMBER,
SOURCE.AGENT_TAX_ID,
'Y' ,
current_timestamp,
'9999-12-31' ,			
SOURCE.PRODUCERGROUP_NAME,
SOURCE.BRANCHNAME	
 );